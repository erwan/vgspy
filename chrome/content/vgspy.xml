<!--
   Copyright Erwan Loisant 2008

   This file may be used under the terms of the
   GNU General Public License Version 2 or later (the "GPL"),
   http://www.gnu.org/licenses/gpl.html

   Software distributed under the License is distributed on an "AS IS" basis,
   WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
   for the specific language governing rights and limitations under the
   License.
-->
<bindings id="vgspy_bindings"
          xmlns="http://www.mozilla.org/xbl"
          xmlns:html="http://www.w3.org/1999/xhtml"
          xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
          xmlns:xbl="http://www.mozilla.org/xbl">

  <binding id="pricebox">
    <content>
      <xul:vbox flex="1">
        <xul:label class="priceLabel"
               xbl:inherits="value=title,tooltiptext=help"
               />
        <xul:vbox anonid="vgspyBox" class="vgPriceBox">
          <children/>
        </xul:vbox>
      </xul:vbox>
    </content>
    <implementation>
      <constructor>
        <![CDATA[
          this._box = document.getAnonymousElementByAttribute(this, "anonid", "vgspyBox");
        ]]>
      </constructor>
      <method name="addPrice">
        <parameter name="aLabel"/>
        <parameter name="aPrice"/>
        <parameter name="aURL"/>
        <body>
          <![CDATA[
            if (this._box.firstChild) {
              if (this._box.firstChild.price <= aPrice) {
                return;
              } else {
                this._box.removeChild(this._box.firstChild);
              }
            }

            var price = document.createElement("hbox");
            var inst = this;
            price.onclick = function(event) {
              var wm = Components.classes["@mozilla.org/appshell/window-mediator;1"]
                       .getService(Components.interfaces.nsIWindowMediator);
              var win = wm.getMostRecentWindow("navigator:browser");
              win.openUILinkIn(aURL, "tab");
            }
            var priceLabel = document.createElement("label");
            priceLabel.setAttribute("value", aLabel);
            priceLabel.setAttribute("class", "priceLink");
            var space = document.createElement("spacer");
            space.setAttribute("flex", "1");
            var priceValue = document.createElement("label");
            priceValue.setAttribute("value", "$" + aPrice.toFixed(2));

            price.appendChild(priceLabel);
            price.appendChild(space);
            price.appendChild(priceValue);
            price.price = aPrice;

            this._box.appendChild(price);
          ]]>
        </body>
      </method>
      <method name="clear">
        <body>
          <![CDATA[

          ]]>
        </body>
      </method>
    </implementation>
  </binding>

</bindings>
